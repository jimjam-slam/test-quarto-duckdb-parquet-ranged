[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "DuckDB ranged requests",
    "section": "",
    "text": "When I go to shell.duckdb.org and run the following query, only 6.5 MB of data is downloaded (the whole file is about 17 MB), thanks to HTTP Range Requests:\nSELECT\n   site_num, date, tmax\n FROM\n   read_parquet('https://jimjam-slam.github.io/test-quarto-duckdb-parquet-ranged/data/acorn-sat.parquet')\n WHERE date = '2021-12-20';\nBut when I use Quarto’s built-in version of DuckDB-WASM, or Observable’s, I get the following console warning and the whole file is downloaded:\n\n\n\n\n\n\nWarning\n\n\n\nfalling back to full HTTP read for: https://jimjam-slam.github.io/test-quarto-duckdb-parquet-ranged/data/acorn-sat.parquet\n\n\n\nacorn = DuckDBClient.of({\n  metadata: FileAttachment(\"https://jimjam-slam.github.io/test-quarto-duckdb-parquet-ranged/data/acorn-metadata.csv\"),\n  obs: FileAttachment(\"https://jimjam-slam.github.io/test-quarto-duckdb-parquet-ranged/data/acorn-sat.parquet\")\n})\n\nacorn\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nLet’s grab a subset of the ACORN-SAT data:\n\nacornData = acorn.sql`\n  SELECT\n    site_num, date, tmax\n  FROM\n    obs\n  WHERE\n    date = '2021-12-20'\n`\n\n\n\n\n\n\n\nInputs.table(acornData)\n\n\n\n\n\n\n\nImport a newer DuckDB manually?\nMaybe we can import a newer version of DuckDB and use that? I’ve forked the original CRU DuckDB client for Observable and bumped the underlying DuckDB version to 1.29.0:\n\nnewDuck = import(\"https://cdn.jsdelivr.net/npm/@duckdb/duckdb-wasm@1.29.0/+esm\")\n\nnewDuck\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport { DuckClient } from \"@jimjamslam/duck\"\n\nDuckClient\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport { arrow } from \"@jimjamslam/duck\"\n\narrow\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nNote\n\n\n\nI’ve renamed DuckDBClient to DuckClient in this fork so that I can test the two simultaneously; Observable’s static notebook imports don’t seem to support aliases.\n\n\nLet’s try it again with the new client:\n\nacornNew = DuckClient.of({\n  obs: FileAttachment(\"https://jimjam-slam.github.io/test-quarto-duckdb-parquet-ranged/data/acorn-sat.parquet\")\n})\n\n\n\n\n\n\n\nacornDataNew = acornNew.sql`\n  SELECT\n    site_num, date, tmax\n  FROM\n    obs\n  WHERE\n    date = '2021-12-20'\n`\n\n\n\n\n\n\n\nInputs.table(acornDataNew)"
  }
]